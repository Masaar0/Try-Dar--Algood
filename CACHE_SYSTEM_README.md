# نظام الكاش للطلبات الفردية

## نظرة عامة

تم إضافة نظام كاش متقدم للطلبات الفردية في صفحة تعديل الطلبات لتحسين الأداء وتجربة المستخدم.

## الميزات الجديدة

### 1. Hook الكاش الفردي (`useOrderCache`)

- **الموقع**: `src/hooks/useOrderCache.ts`
- **الوظيفة**: إدارة كاش الطلبات الفردية
- **المدة**: 30 دقيقة لكل طلب
- **السعة القصوى**: 100 طلب

#### الوظائف المتاحة:

- `getFromCache(orderId)`: الحصول على طلب من الكاش
- `setCache(orderId, data)`: حفظ طلب في الكاش
- `updateCache(orderId, data)`: تحديث طلب في الكاش
- `hasInCache(orderId)`: التحقق من وجود طلب في الكاش
- `getCacheAge(orderId)`: الحصول على عمر الكاش
- `clearCache()`: مسح الكاش بالكامل
- `getCacheStats()`: إحصائيات الكاش

### 2. تحديث صفحة تعديل الطلب (`OrderEditPage`)

- **الموقع**: `src/pages/OrderEditPage.tsx`
- **التحسينات**:
  - تحميل فوري من الكاش عند الدخول لتعديل طلب محفوظ
  - حفظ تلقائي في الكاش عند تحميل طلب جديد
  - تحديث الكاش عند حفظ التغييرات
  - رسائل console.log لتتبع عملية الكاش

### 3. تحديث صفحة إدارة الطلبات (`OrdersManagement`)

- **الموقع**: `src/components/admin/OrdersManagement.tsx`
- **الميزات الجديدة**:
  - مؤشر يظهر عدد الطلبات المحفوظة في الكاش
  - نقطة خضراء بجانب رقم الطلب للطلبات المحفوظة في الكاش
  - زر لمسح الكاش الفردي
  - رسائل تأكيد عند مسح الكاش

## كيفية العمل

### عند الدخول لتعديل طلب:

1. **التحقق من الكاش**: النظام يتحقق أولاً من وجود الطلب في الكاش
2. **إذا كان موجوداً**: يتم تحميل البيانات فوراً من الكاش (بدون انتظار)
3. **إذا لم يكن موجوداً**: يتم تحميل البيانات من الخادم وحفظها في الكاش

### عند حفظ التغييرات:

1. يتم حفظ التغييرات في الخادم
2. يتم تحديث الكاش بالبيانات الجديدة
3. يتم عرض رسالة نجاح

### إدارة الكاش:

- **تنظيف تلقائي**: يتم حذف الطلبات القديمة (أكثر من 30 دقيقة) تلقائياً
- **إدارة الذاكرة**: عند الوصول للحد الأقصى (100 طلب)، يتم حذف الأقدم
- **مسح يدوي**: يمكن للمدير مسح الكاش يدوياً من صفحة إدارة الطلبات

## الفوائد

### للمستخدم:

- **سرعة فائقة**: تحميل فوري للطلبات المحفوظة في الكاش
- **تجربة سلسة**: لا توجد رسائل تحميل للطلبات المحفوظة
- **عملية خلفية**: كل شيء يتم بشكل خلفي وداخلي

### للنظام:

- **تقليل الطلبات**: تقليل عدد الطلبات للخادم
- **تحسين الأداء**: تحميل أسرع للبيانات المتكررة
- **إدارة ذكية**: تنظيف تلقائي وإدارة الذاكرة

## الإعدادات

### مدة الكاش:

```typescript
const CACHE_DURATION = 30 * 60 * 1000; // 30 دقيقة
```

### السعة القصوى:

```typescript
const MAX_CACHE_SIZE = 100; // 100 طلب
```

### عتبة الوصول:

```typescript
const ACCESS_THRESHOLD = 2; // عدد مرات الوصول المطلوبة
```

## المراقبة والتشخيص

### رسائل Console:

- `تم تحميل الطلب {orderId} من الكاش`
- `تحميل الطلب {orderId} من الخادم`

### مؤشرات واجهة المستخدم:

- مؤشر أخضر يظهر عدد الطلبات المحفوظة في الكاش
- نقطة خضراء بجانب الطلبات المحفوظة في الكاش
- زر مسح الكاش مع عداد الطلبات

## التطوير المستقبلي

### ميزات محتملة:

1. **كاش ذكي**: حفظ الطلبات الأكثر استخداماً لفترة أطول
2. **مزامنة تلقائية**: تحديث الكاش عند تغيير الطلبات من مصادر أخرى
3. **إحصائيات متقدمة**: تتبع استخدام الكاش وتحسين الأداء
4. **كاش مشترك**: مشاركة الكاش بين المستخدمين المختلفين

## استكشاف الأخطاء

### مشاكل شائعة:

1. **الطلبات لا تظهر في الكاش**: تحقق من مدة الكاش (30 دقيقة)
2. **الكاش ممتلئ**: النظام يحذف الأقدم تلقائياً
3. **بيانات قديمة**: استخدم زر مسح الكاش الفردي

### حلول:

- مسح الكاش يدوياً من صفحة إدارة الطلبات
- إعادة تشغيل التطبيق لمسح الكاش بالكامل
- التحقق من رسائل console للتشخيص
